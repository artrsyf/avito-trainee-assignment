# **Тестовое задание для стажёра Backend (зимняя волна 2025)**

## **Работа с сервисом**

### Клонирование репозитория
```sh
git clone https://github.com/artrsyf/avito-trainee-assignment.git
cd avito-trainee-assignment
```

### Подготовка секретов
Необходимо создать .env файл в директории avito-trainee-assignment/cmd и перенести в нее енвы из .env.example

### Запуск проекта
```sh
make run
```

### Остановка проекта + удаление контейнеров, вольюмов
```sh
make drop
```

### Запуск unit-тестов
```sh
make unit_test
```

### Запуск интеграционных тестов
```sh
make integration_test
```

### Запуск e2e-тестов
```sh
make e2e_test
```

### Запуск линтера
```sh
make lint
```

### Справка
Можно узнать все доступные команды, а также их описание:
```sh
make help
```

## **Общее описание**
### Стек
В данном проекте используются Golang, PostgreSQL, Redis

### Структура проекта
- **/.github** - CI проекта
- **/cmd** - entrypoint приложения с енвами
- **/config** - конфиг приложения
- **/docker** - docker-файлы
- **/docs** - результаты покрытия тестами
- **/internal**
    - **/middleware** — мидлвары приложения
    - **/<сущность>**
        - **/delivery** — слой доставки
        - **/domain** — слой данных
        - **/repository** — слой доступа к данным
        - **/usecase** — слой бизнес-логики
- **/pkg** — дополнительные библиотеки
- **/postgres** — конфиг файл для PostgreSQL
- **/scripts** — миграция БД
- **/tests** — интеграционные, e2e и load-тесты

### Подход к архитектуре
Используется слоистая архитектура с разделением зон ответственности:
- Слой Repository отвечает за работу с хранилещем данных;
- Слой Usecase отвечает за бизнес-логику;
- Слой Delivery отвечает за обработку запросов-ответов.
- Слой Domain отвечает за представление данных.

Работа с инфраструктурой осуществляется через инверсию зависимостей.
<br>
Также работа с транзакциями осуществляется с помощью вспомогательной структуры - Unit Of Work.
Она предназначена для создания абстракции над транзакциями на уровне usecase, т.к. использование транзакций - непосредственно бизнес-логика, однако использование sql-адаптеров напрямую нарушает принцип разделения слоев.

### Работа с данными
Данные было принято разделить на три типа:
- DTO - данные, необходимые для передачи между слоями, пользовательские запросы и ответы;
- Entity - данные, отражающие сущности без привязки к инфраструктуре;
- Model - данные, соответствующие таблицам в БД.

### Структура БД
![DB Screenshot](docs/assets/db.png)

## **Структура Docker-сети**
![Docker Screenshot](docs/assets/docker.png)

## **Отчет о нагрузочном тестировании**
![Docker Screenshot](docs/assets/load.png)

## **Особенности**
1. В проект добавлен Redis, который используется для stateful проверки и контроля сессий;
2. Авторизация реализовывалась изначально под работу с access и refresh токенами, но из-за условия задания работы только с access-токеном используется только он с дефолтным значением жизни - 2 часа.
3. Отчет о покрытии unit-тестами (покрыты слои repository и usecase) расположен в папке docs.
4. Также в папке docs есть curls.txt файл, в котором хранятся ручные тесты на различные сценарии со следующей структурой:
    >
        <curl запрос>
        
        <код ответа>

        <тело ответа>
        ...

## **Выполненные задачи**
1. Реализована общая структура проекта в соответствии с условием;
2. Добавлены логи с logrus;
3. Написаны unit-, интеграционные, e2e- и load-тесты;
4. Приложение завернуто в докер, есть окружение для тестов;
5. Используется линтер;
6. Написан сценарий CI для автоматического прогона тестов и линтера;
7. Написан makefile для работы с проектом.